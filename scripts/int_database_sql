/*
==========================================
Create database and schemas
==========================================
Script Purpose:
This script creates a new database named ‘DataWarehous’ after checking if it already exists. If the database exists, it is dropped and recreated. Additionally, the script sets up three schemas within the databse: ‘bronze’, ‘silver’, and ‘gold’.

Warning:
Running this script will drop the entire ‘DataWarehouse’ database if it exists. All data in the database will be permanently deleted. Proceed with caution and ensure you have proper backups before running this script.
*/

-- Database: DataWarehouse
-- DROP DATABASE IF EXISTS "DataWarehouse";

CREATE DATABASE "DataWarehouse"
    WITH
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'English_United States.1252'
    LC_CTYPE = 'English_United States.1252'
    LOCALE_PROVIDER = 'libc'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1
    IS_TEMPLATE = False;

-- SCHEMA: bronze
-- DROP SCHEMA IF EXISTS bronze ;
CREATE SCHEMA IF NOT EXISTS bronze
    AUTHORIZATION postgres;

-- SCHEMA: silver
-- DROP SCHEMA IF EXISTS silver ;
CREATE SCHEMA IF NOT EXISTS silver
    AUTHORIZATION postgres;

-- SCHEMA: gold
-- DROP SCHEMA IF EXISTS gold ;
CREATE SCHEMA IF NOT EXISTS gold
    AUTHORIZATION postgres;

-- Table: bronze.crm_cust_info

DROP TABLE IF EXISTS bronze.crm_cust_info;
CREATE TABLE IF NOT EXISTS bronze.crm_cust_info
(
    cst_id integer,
    cst_key character varying(50) COLLATE pg_catalog."default",
    cst_firstname character varying(50) COLLATE pg_catalog."default",
    cst_lastname character varying(50) COLLATE pg_catalog."default",
    cst_marital_status character(1) COLLATE pg_catalog."default",
    cst_gndr character(1) COLLATE pg_catalog."default",
    cst_create_date date,
    CONSTRAINT crm_cust_info_cst_marital_status_check CHECK (cst_marital_status = ANY (ARRAY['S'::bpchar, 'M'::bpchar])),
    CONSTRAINT crm_cust_info_cst_gndr_check CHECK (cst_gndr = ANY (ARRAY['M'::bpchar, 'F'::bpchar]))
)
TABLESPACE pg_default;
ALTER TABLE IF EXISTS bronze.crm_cust_info
    OWNER to postgres;

-- Table: bronze.crm_prd_info

-- DROP TABLE IF EXISTS bronze.crm_prd_info;
CREATE TABLE IF NOT EXISTS bronze.crm_prd_info
(
    prd_id integer,
    prd_key character varying(30) COLLATE pg_catalog."default",
    prd_nm character varying(100) COLLATE pg_catalog."default",
    prd_cost numeric(10,2),
    prd_line character(1) COLLATE pg_catalog."default",
    prd_start_dt date,
    prd_end_dt date,
    CONSTRAINT crm_prd_info_prd_line_check CHECK (prd_line = ANY (ARRAY['R'::bpchar, 'S'::bpchar]))
)
TABLESPACE pg_default;
ALTER TABLE IF EXISTS bronze.crm_prd_info
    OWNER to postgres;

-- Table: bronze.crm_sales_details

-- DROP TABLE IF EXISTS bronze.crm_sales_details;
CREATE TABLE IF NOT EXISTS bronze.crm_sales_details
(
    sls_ord_num character varying(20) COLLATE pg_catalog."default",
    sls_prd_key character varying(30) COLLATE pg_catalog."default",
    sls_cust_id integer,
    sls_order_dt date,
    sls_ship_dt date,
    sls_due_dt date,
    sls_sales numeric(10,2),
    sls_quantity integer,
    sls_price numeric(10,2)
)
TABLESPACE pg_default;
ALTER TABLE IF EXISTS bronze.crm_sales_details
    OWNER to postgres;

-- Table: bronze.erp_cust_az12

-- DROP TABLE IF EXISTS bronze.erp_cust_az12;
CREATE TABLE IF NOT EXISTS bronze.erp_cust_az12
(
    cid character varying(20) COLLATE pg_catalog."default",
    bdate date,
    gen character varying(10) COLLATE pg_catalog."default",
    CONSTRAINT erp_cust_az12_gen_check CHECK (gen::text = ANY (ARRAY['Male'::character varying, 'Female'::character varying]::text[]))
)
TABLESPACE pg_default;
ALTER TABLE IF EXISTS bronze.erp_cust_az12
    OWNER to postgres;

-- Table: bronze.erp_loc_a101

-- DROP TABLE IF EXISTS bronze.erp_loc_a101;
CREATE TABLE IF NOT EXISTS bronze.erp_loc_a101
(
    cid character varying(20) COLLATE pg_catalog."default",
    cntry character varying(50) COLLATE pg_catalog."default"
)
TABLESPACE pg_default;
ALTER TABLE IF EXISTS bronze.erp_loc_a101
    OWNER to postgres;

-- Table: bronze.erp_px_cat_g1v2

-- DROP TABLE IF EXISTS bronze.erp_px_cat_g1v2;
CREATE TABLE IF NOT EXISTS bronze.erp_px_cat_g1v2
(
    id character varying(10) COLLATE pg_catalog."default",
    cat character varying(50) COLLATE pg_catalog."default",
    subcat character varying(100) COLLATE pg_catalog."default",
    maintenance text
)
TABLESPACE pg_default;
ALTER TABLE IF EXISTS bronze.erp_px_cat_g1v2
    OWNER to postgres;
