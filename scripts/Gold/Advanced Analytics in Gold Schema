Change Over Time Analysis
===============================================================================
Purpose:
    - To track trends, growth, and changes in key metrics over time.
    - For time-series analysis and identifying seasonality.
    - To measure growth or decline over specific periods.

SQL Functions Used:
    - Date Functions: EXTRACT (YEAR FROM...), (EXTRACT MONTH FROM ....), DATE_TRUNC(), TO_CHAR()
    - Aggregate Functions: SUM(), COUNT(), AVG()
===============================================================================
*/

-- Analyse sales performance over time
-- Quick Date Functions in Postgres
SELECT
  EXTRACT(YEAR FROM order_date)::int AS order_year,
  EXTRACT(MONTH FROM order_date)::int AS order_month,
  SUM(sales) AS total_sales,
  COUNT(DISTINCT customer_key) AS total_customers,
  SUM(quantity) AS total_quantity
FROM gold.fact_sales
WHERE order_date IS NOT NULL
GROUP BY EXTRACT(YEAR FROM order_date)::int, EXTRACT(MONTH FROM order_date)::int
ORDER BY EXTRACT(YEAR FROM order_date)::int, EXTRACT(MONTH FROM order_date)::int;

-- DATETRUNC() in Postgres
SELECT
  date_trunc('month', order_date) AS order_month,
  SUM(sales) AS total_sales,
  COUNT(DISTINCT customer_key) AS total_customers,
  SUM(quantity) AS total_quantity
FROM gold.fact_sales
WHERE order_date IS NOT NULL
GROUP BY date_trunc('month', order_date)
ORDER BY date_trunc('month', order_date);

-- TO_CHAR()
SELECT
  to_char(date_trunc('month', order_date), 'YYYY-MON') AS order_date,
  SUM(sales) AS total_sales,
  COUNT(DISTINCT customer_key) AS total_customers,
  SUM(quantity) AS total_quantity
FROM gold.fact_sales
WHERE order_date IS NOT NULL
GROUP BY date_trunc('month', order_date)
ORDER BY date_trunc('month', order_date);
