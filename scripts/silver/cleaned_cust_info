-- DATA STANDARDIZATION & CONSISTENCY 
-- removing unwanted spaces, maps coded values to meaningful, 
-- user-friendly descriptions (i.e. data normalization & standardization)
-- handling missing values (fill in the blanks by adding a default value)
-- ensuring only one record per entity by removing duplicates (identify and retaining the most relevant rows.
--(in doing this, there may be need to increase the character-length of the target columns)
INSERT INTO
	SILVER.CRM_CUST_INFO (
		CST_ID,
		CST_KEY,
		CST_FIRSTNAME,
		CST_LASTNAME,
		CST_MARITAL_STATUS,
		CST_GNDR,
		CST_CREATE_DATE
	)
SELECT
	CST_ID,
	CST_KEY,
	TRIM(CST_FIRSTNAME) AS CST_FIRSTNAME,
	TRIM(CST_LASTNAME) AS CST_LASTNAME,
	CASE
		WHEN UPPER(TRIM(CST_MARITAL_STATUS)) = 'S' THEN 'Single'
		WHEN UPPER(TRIM(CST_MARITAL_STATUS)) = 'M' THEN 'Married'
		ELSE 'N/A'
	END AS CST_MARITAL_STATUS,
	CASE
		WHEN UPPER(TRIM(CST_GNDR)) = 'F' THEN 'female'
		WHEN UPPER(TRIM(CST_GNDR)) = 'M' THEN 'Male'
		ELSE 'N/A'
	END AS CST_GNDR,
	CST_CREATE_DATE
FROM
	(
		SELECT
			*,
			ROW_NUMBER() OVER (
				PARTITION BY
					CST_ID
				ORDER BY
					CST_CREATE_DATE DESC
			) AS FLAG_LAST
		FROM
			BRONZE.CRM_CUST_INFO
	) AS T
WHERE
	FLAG_LAST = 1;
