-- INSERT CONTENT INTO THE SILVER SCHEMA
INSERT INTO silver.crm_sales_details
(
    sls_ord_num,
    sls_prd_key,
    sls_cust_id,
    sls_order_dt,
    sls_ship_dt,
    sls_due_dt,
    sls_sales,
    sls_quantity,
    sls_price
)
SELECT
	SLS_ORD_NUM,
	SLS_PRD_KEY,
	SLS_CUST_ID,
CASE WHEN SLS_ORDER_DT =0 OR LENGTH(SLS_ORDER_DT::TEXT)<>8 THEN NULL
	ELSE CAST (CAST(SLS_ORDER_DT AS CHARACTER VARYING) AS DATE)
END AS SLS_ORDER_DT,
CASE WHEN SLS_SHIP_DT =0 OR LENGTH(SLS_SHIP_DT::TEXT)<>8 THEN NULL
	ELSE CAST (CAST(SLS_SHIP_DT AS CHARACTER VARYING) AS DATE)
END AS SLS_SHIP_DT,
CASE WHEN SLS_DUE_DT =0 OR LENGTH(SLS_DUE_DT::TEXT)<>8 THEN NULL
	ELSE CAST (CAST(SLS_DUE_DT AS CHARACTER VARYING) AS DATE)
END AS SLS_DUE_DT,
	CASE
		WHEN SLS_SALES IS NULL
		OR SLS_SALES <= 0
		OR SLS_SALES <> SLS_QUANTITY * ABS(SLS_PRICE) THEN SLS_QUANTITY * ABS(SLS_PRICE)
		ELSE SLS_SALES
	END AS SLS_SALES,
	SLS_QUANTITY,
	CASE
		WHEN SLS_PRICE IS NULL
		OR SLS_PRICE <= 0 THEN SLS_SALES / NULLIF(SLS_QUANTITY, 0)
		ELSE SLS_PRICE
	END AS SLS_PRICE

FROM
	BRONZE.CRM_SALES_DETAILS;
